<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/3474/3474056.png" type="image/x-icon">
        <title>Resultado Filtrado</title>
        <link rel="stylesheet" href="/static/resultado.css">

        <style>
            /* Estilos para impressão */
            @media print {
                header, footer { position: fixed; width: 100%;}
                header {top: 0;}
                footer {bottom: 0;}
                button {display: none;} /* Esconde botões ao imprimir */ 
                main {margin-top: 60px; margin-bottom: 40px;}
            }
        </style>   

        <script>
            document.addEventListener("DOMContentLoaded", function() {
                // Obter o elemento do input de data
                const dateInput = document.getElementById("param4");
                
                // Configurar a data de hoje no formato adequado (YYYY-MM-DD)
                const today = new Date();
                const yyyy = today.getFullYear();
                const mm = String(today.getMonth() + 1).padStart(2, '0'); // Adicionar zero à esquerda
                const dd = String(today.getDate()).padStart(2, '0'); // Adicionar zero à esquerda
                
                // Definir o valor do input para a data de hoje no formato YYYY-MM-DD
                dateInput.value = `${yyyy}-${mm}-${dd}`;
            });

            document.addEventListener("DOMContentLoaded", function () {
                const selectParam3 = document.getElementById("param3");

                selectParam3.addEventListener("change", function () {
                    if (selectParam3.value === "Reprovado") {
                        selectParam3.classList.add("Reprovado");
                    } else {
                        selectParam3.classList.remove("Reprovado");
                    }
                });
            });

        </script>
    </head>
    <body>
        <div class="container">
            <form action="/gerar_pdf" method="POST" target="_blank">
                <button type="button" class="btn-voltar" onclick="window.location.href='/'">Página inicial</button>
                <button type="submit" class="no-print" >Imprimir</button>
                <header>
                    <table>
                        <tr>
                            <td class="logo">
                                <img src="https://ourofinoagro.com.br/wp-content/uploads/2020/02/logo-OurofinoAgro.svg" alt="Logo da Empresa" />
                            </td>
                            <td class="title" colspan="2">
                                DADOS DE TEMPERATURA E/OU UMIDADE
                            </td>
                            <td>
                                <div class="content">
                                    <div class="line-separator">
                                        <div style="margin-top: 0.1em;"></div>
                                        <!-- Formulação -->
                                        <span class="formula-text">For.2.031</span>
                                    </div>
                                    <div style="margin-top: 0.1em;">
                                        <!-- Revisão -->
                                        <span class="revision-text">Rev. 00</span>
                                    </div>
                                </div>
                                
                                <td>
                                    <div class="content">
                                        <div class="line-separator" style="margin-top: 0.1em;">
                                            <!-- Paginas -->
                                            <span class="page-text">1/1</span>
                                        </div>
                                
                                        <div>
                                            <div style="margin-top: 0.1em;">
                                                <!-- Aprovado/Reprovado -->
                                                <span class="approval-status">Aprovado</span>
                                            </div>
                                            <div style="margin-top: 0.1em;">
                                                <!-- Data -->
                                                <span class="date-text">24/03/2025</span>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </table>
                </header>
                
                <div class="header-space"></div>

                <table class="table-items">
                    <tr>
                        <td class="bordered-cell">
                            <span class="label">Número do estudo:</span>
                        </td>
                        <td class="input-space"><input type="text" id="param5" name="param5" value="" placeholder="Digite o Numero do Estudo" style="text-align: center; width: 15em;" required></td>

                        <td class="bordered-cell">
                            <span class="label">Código do equipamento:</span>
                        </td>
                        <td class="input-space"><input type="text" id="param6" name="param6" value="" placeholder="Digite o Código do equipamento" style="text-align: center; width: 15em;" required></td>
                    </tr>
                    <tr>
                        <td class="bordered-cell">
                            <span class="label">Número do ensaio:</span>
                        </td>
                        <td class="input-space"><input type="text" id="param7" name="param7" value="" placeholder="Digite o Número do ensaio" style="text-align: center; width: 15em;" required></td>

                        <td class="bordered-cell">
                            <span class="label">Local de leitura do equipamento:</span>
                        </td>
                        <td class="input-space"><input type="text" id="param8" name="param8" value="" placeholder="Digite o Local de leitura" style="text-align: center; width: 15em;" required></td>

                    </tr>
                </table>
                
            </form>
            
            <div class="sub-header">

                <div class="table-results">
                    {{ table|safe }}
                </div>
                
            </div>
        </div>
      
        <!-- Rodapé -->
                <footer>
                    <span>Desenvolvido por <a href="https://linkedin.com/in/rafaelcruzdossantos" target="_blank">Rafael Santos</a></span>
                        <img src="https://lh3.googleusercontent.com/a/ACg8ocKhLVbpXP2X6W65_y-pz4BOuLpbJTSLouuR7psI4ErhaN0RyDHY=s96-c-rg-br100" type="image/x-icon" alt="Foto de Rafael Santos" class="foto-rodape">
                    <span>| Todos os direitos reservados © 2025</span>
                </footer>
        
    </body>
<!-- Adicionar no final do arquivo, antes de </body> -->
<script>
// Detectar quando o usuário fecha a aba/navegador
window.addEventListener('beforeunload', function(e) {
    // Enviar sinal para o servidor limpar uploads
    navigator.sendBeacon('/cleanup-uploads');
});

// Detectar quando a página perde o foco (usuário mudou de aba)
let isPageVisible = true;
document.addEventListener('visibilitychange', function() {
    if (document.hidden) {
        isPageVisible = false;
        // Aguardar um tempo e verificar se a página ainda está oculta
        setTimeout(function() {
            if (!isPageVisible && document.hidden) {
                navigator.sendBeacon('/cleanup-uploads');
            }
        }, 30000); // 30 segundos
    } else {
        isPageVisible = true;
    }
});
</script>
</html>
